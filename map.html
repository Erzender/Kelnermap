<html>

<head>
    <title>Map</title>
    <meta charset="UTF-8">
    <script src="vue.min.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css">
</head>

<body>
  <div id="app" class="noselect">
    <div style="display: flex; flex: 1; max-height: 40px;">
      <button v-on:click="setRoute(button)" style="display: flex; flex: 1; max-width: 100px; align-items: center; justify-content: center;" v-for="button in navBar">{{button}}</button>
    </div>
    <div v-if="route === 'Nations'" style="display: flex; flex: 1; flex-direction: column; overflow: auto;">
      <div id="nationCnt" v-on:click="setNavNation(nation.name)" v-for="nation in nations" >
        <div v-bind:style="{backgroundColor: nation.color, height: '10px', opacity: 0.3 }"></div>
        <div style="padding: 5px;">
          <div>{{nation.name}}</div>
          <div>Leader : {{nation.leader}}</div>
          <div>Soutiens: {{nation.soutiens}}</div>
        </div>
      </div>
    </div>
    <div v-if="route === 'Nation' && navNation !== null" style="display: flex; flex: 1; flex-direction: column; background-color: #DDDDDD; border-radius: 20px; overflow: hidden; margin: 5px;">
      <div v-bind:style="{ backgroundColor: nation.color, opacity: 0.3, minHeight: '20px', maxHeight: '20px', display: 'flex', flex: 1 }"></div>
      <div style="display: flex; flex: 1; flex-direction: column; overflow: hidden; padding: 10px;">
        <h1>{{nation.name}}</h1>
        <div>Leader : {{nation.leader}}</div>
        <div>Etendue : {{Math.round(nation.areas.length * 0.178 * 10) / 10}} km2</div>
        <div style="display: flex; flex-direction: column; margin: 20px; flex: 1; overflow: hidden;">
          <div><button v-on:click="navNationPanel('desc')">Description</button><button v-on:click="navNationPanel('soutiens')">Soutiens</button><button v-on:click="navNationPanel('descEdit')" v-bind:style="{color: nav.nationPanel==='descEdit'?'green':'black'}">{{nav.nationPanel!=="descEdit"?"Editer la description":"Sauvegarder"}}</button></div>
          <div v-if="nav.nationPanel === 'desc'" v-html="markdown.toHTML(nation.description)" style="display: flex; flex: 1; flex-direction: column; word-break: break-all; padding: 10px; background-color: white; overflow: auto;"></div>
          <div style="margin: 10px;">Pour modifier la description de votre nation, éditer ici puis sauvegarder le fichier et l'uploader dans #territoires sur Discord. <a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Syntaxe markdown : astuces</a></div>
          <div v-if="nav.nationPanel === 'descEdit'" style="display: flex; flex: 1; overflow: hidden;">
            <textarea id="descEditInput" v-model="descEdit" style="display: flex; flex: 1; flex-direction: column; word-break: break-all; padding: 10px; background-color: white; overflow: auto; resize: none;"></textarea>
            <div v-html="markdown.toHTML(descEdit)" style="display: flex; flex: 1; flex-direction: column; word-break: break-all; padding: 10px; background-color: white; overflow: auto;"></div>
          </div>
          <div v-if="nav.nationPanel === 'soutiens'" style="display: flex; flex: 1; background-color: white; flex-direction: color; overflow: auto;">
            <div v-for="soutien in nation.soutiens" style="display: flex; flex: 1; backgroundColor: #DDDDDD; border-radius: 10px; padding: 10px; max-height: 50px; min-height: 50px; margin: 5px; flex-direction: column;">
              <div>{{soutien.name}}</div>
              <div>Rang {{soutien.rank}} dans sa liste d'appuis.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div v-if="route === 'Map'" style="display: flex; flex: 1;">
        <div style="background-color: #DDDDDD; min-width: 200px; max-width: 200px; display: flex; flex-direction: column; padding: 10px; border-top-left-radius: 20px;">
            <div>{{"X : " + mouseMap.left}}</div>
            <div>{{"Z : " + mouseMap.top}}</div>
            <div>{{"x : " + area.x}}</div>
            <div>{{"z : " + area.z}}</div>
            <form v-on:submit="searchArea(search.x, search.z, $event)">
              <div>X<input v-model="search.x" style="width: 80px" type="number"></input>Z<input v-model="search.z" style="width: 80px" type="number"></input></div>
              <button v-on:click="searchArea(search.x, search.z)">Recherche</button>
            </form>
            <div>{{"Territoire : " + area.name}}</div>
            <div style="width: 20px; height: 20px; border-style: solid;" v-bind:style="{backgroundColor: area.color}"></div>
            <div>{{"Leader : " + area.leader}}</div>
            <button v-on:click="toggleGrid">Grille</button>
            <button v-on:click="toggleControl">Régions</button>
            <button v-on:click="toggleEdit">{{nav.mapEdit?"Sélection terminée":"Déclarer une région"}}</button>
            <input v-if="nav.mapEdit" type="text" v-model="textMapEdit" id="mapEditInput" style="color: transparent; background-color: transparent; border-style: none;">
            {{message}}
        </div>
        <div id="mapCnt" style="overflow: auto; display: flex; flex: 1;">
            <div id="map" style="min-width: 850px; width: 850px; height: 850px; display: flex; background-image: url('map.png'); background-size: 100% 100%;"
                @mousemove="updateMouseMap">
                <div style="display: flex; flex: 1; flex-direction: column;" v-for="(line, x) in colors">
                    <div style="display: flex; flex: 1; border-width: 1px; border-style: solid; border-color: white;" v-for="(area, z) in line" v-bind:style="{ borderWidth: border, backgroundColor: area, opacity: 0.4}" @mouseover="updateArea(x, z)" v-on:click="updateArea(x, z, true)"></div>
                </div>
            </div>
        </div>
    </div>
  </div>
  <script type="text/javascript" src="markdown.min.js"></script>
  <script type="text/javascript" src="utils.js"></script>
  <script type="text/javascript" src="methodsMap.js"></script>
  <script type="text/javascript" src="map.js"></script>
</body>
